<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity4">
<head th:replace="partials/layout :: header">
    <meta charset="UTF-8">
    <title>Edit Profile</title>
</head>
<body>
<div th:replace="states/svg :: states-svg" />
<div th:replace="partials/layout :: navbar" />

<!--state news modal-->
<!--body continues to scroll while user is scrolling through modal-->
<div class="modal fade" id="modal" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLongTitle" th:text="${state}"></h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <ul id="morenews"></ul>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<div class="container mt-4">
    <div class="userProfile row">
        <div class="col-md-6">
            <div class="card">
                <!--placeholder-->
                <!--<img class="card-img-top img-fluid mx-auto mt-3" src="/img/face_icons-circle-63.png" alt="Card image cap" style="width: 200px">-->
                <!--actual profile pictures-->
                <img th:if="${user.profile.uploadPath == null}" style="height: 150px; width: 150px; margin: 0 auto" th:src="@{/img/defaultavatar.png}" alt="none" />
                <img th:if="${user.profile.uploadPath}" style="height: 150px; width: 150px; margin: 0 auto" th:src="@{/uploads/} + ${user.profile.uploadPath}"  alt="didn't work" />
                <div class="card-body">
                    <!--<h5 class="card-title">Card title</h5>-->
                    <h1 class="text-center"> <span th:text="${#authentication.principal.profile.firstName}"></span> </h1>
                    <p class="card-text text-center"> <span th:text="${#authentication.principal.profile.name}"></span> </p>

                </div>
            </div>
        </div>
        <br />
        <div class="col-md-6">
            <div class="card">
                <div class="card-body">
                    <!--<h5 class="card-title">Card title</h5>-->
                    <h4 class="text-left">Your name:</h4>
                    <h4 class="text-center"> <span th:text="${#authentication.principal.profile.firstName}"></span> </h4>
                    <h4 class="text-center"> <span th:text="${#authentication.principal.profile.lastName}"></span> </h4>
                    <h4 class="text-left">Your email:</h4>
                    <h4 class="text-center"> <span th:text="${#authentication.principal.profile.email}"></span></h4>
                    <h4 class="text-left">You live in:</h4>
                    <h4 class="text-center"><span th:text="${#authentication.principal.profile.userState}"></span></h4>
                    <!--<h1 class="text-center"> <span th:text="${#authentication.principal.profile.firstName}"></span> </h1>-->
                    <h4 class="text-left">About you:</h4>
                    <p class="card-text text-center"> <span th:text="${#authentication.principal.profile.name}"></span> </p>
                </div>
                <button class="btn btn-sm"><a th:href="@{/editprofile}"> Edit Profile</a> </button>
            </div>
        </div>

        <!--news tab for user's state-->

        <div class="col-md-6">
            <div class="card">
                <div class="card-body">
                    <ul id="statenews" th:data-state-name="${#authentication.principal.profile.userState}"></ul>
                    <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#modal">View more News</button>
                </div>
            </div>
        </div>

        <!--state and rating tab-->

        <div class="col-md-6">
            <div class="card">
                <h4 class="card-title" style="text-align: center">Your State and Rating</h4>
                <div class="card-body">
                    <div class="state pt-4">
                        <svg th:class="@{icon icon-state-} + ${state.abbr}">
                            <use th:xlink:href="@{#icon-state-} + ${state.abbr}"></use>
                        </svg>
                    </div>
                </div>
            </div>
        </div>

        <!--notifications area-->

        <div class="row m-5 m-auto">
            <div class="col-6 text-center">
                <h3 style="margin-top: 1em">Your notifications</h3>
                <div class="col-12 m-3 d-inline">
                    <button type="button" class="btn btn-primary notification-profile m-2">
                        Email <span class="badge badge-light">4</span>
                    </button>
                    <button type="button" class="btn btn-primary notification-profile m-2">
                        Text Message <span class="badge badge-light">4</span>
                    </button>
                </div>
            </div>
            <div class="col-6 text-center">
                <h3 style="margin-top: 1em">Social media</h3>
                <div class="col-12 m-4 d-inline">
                    <img class="fluid-img m-2" th:height="50" src="/img/Facebook.png">
                    <img class="fluid-img m-2" th:height="50" src="/img/Google%20Plus.png">
                </div>
            </div>
        </div>
    </div>
</div>
<!-- end of tab-pane-fade -->

<div th:replace="partials/layout :: footer" />

<script type="text/javascript">
    // USER RATE VALUE FOR VIOLENCE
    var sliderOne = document.getElementById("violenceRate");
    var outputOne = document.getElementById("demoViolence");
    outputOne.innerHTML =sliderOne.value;

    sliderOne.oninput = function(){
        outputOne.innerHTML = this.value;
    };

    // // USER RATE VALUE FOR EMPLOYMENT
    var sliderTwo = document.getElementById("employmentRate");
    var outputTwo = document.getElementById("demoEmployment");
    outputTwo.innerHTML = sliderTwo.value;

    sliderTwo.oninput = function (){
        outputTwo.innerHTML = this.value;
    };
    //
    // //USER RATE VALUE FOR EDUCATION
    var sliderThree = document.getElementById("educationRate");
    var outputThree = document.getElementById("demoEducation");
    outputThree.innerHTML = sliderThree.value;

    sliderThree.oninput = function (){
        outputThree.innerHTML = this.value;
    };

    // // USER RATE VALUE FOR HEALTH
    var sliderFour = document.getElementById("healthRate");
    var outputFour = document.getElementById("demoHealth");
    outputFour.innerHTML = sliderFour.value;

    sliderFour.oninput = function () {
        outputFour.innerHTML = sliderFour.value;
    };

    // USER RATE VALUE FOR GROWTH
    var slider = document.getElementById("growthRate");
    var output = document.getElementById("demoGrowth");
    output.innerHTML = slider.value; // Display the default slider value

    // Update the current slider value (each time you drag the slider handle)
    slider.oninput = function() {
        output.innerHTML = this.value;
    };


    // ---------------- OVERALL RATING FROM THE SLIDERS -------------------------------

    $('.slider').each(function() {

        $(this).on('change', function() {
            calcavg();
        })
    });
    function calcavg() {
        var total = 0;
        var avg = 0;

        $('.slider').each(function() {
            if (!isNaN(this.value) && this.value.lenght !=0) {
                total +=parseFloat(this.value);
                // alert(total);
            }
        });
        if (!isNaN(total) && total !=0) {
            // var txtboxes = $('.cal-rating').length;
            var txtboxes = 5;
            Average = parseFloat(total) / 5;
        }
        $('#totalMarks').html(Average);
        // Show Average upto 2 decimal places using .toFixed() method.
        // var star = parseFloat(Average.toFixed(2)) * 20;
        // $('.avg-ovral-rtng .rating-stars').css("width", star + "%");
    }
</script>
<script th:src="@{~/built/state.js}"></script>
<script th:src="@{~/built/news.js}"></script>
</body>
</html>