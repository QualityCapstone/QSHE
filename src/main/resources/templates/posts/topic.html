<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity4">
<head th:replace="partials/layout :: header (page='Topic')">
    <meta charset="UTF-8" />
    <title>Home</title>
</head>
<div th:replace="partials/layout :: navbar" />
<span class="overlay"></span>
<div th:replace="partials/layout :: navbar-profile" />

</div>


<div class="container bg-white text-center border border-dark rounded mt-5" sec:authorize="isAuthenticated()">

    <table class="table table-hover">
        <thead>
            <tr>
                <th></th>
                <th class="sticky-top" >User</th>
                <th class="sticky-top">From</th>
                <th class="d-none d-sm-table-cell sticky-top">Post</th>
            </tr>
        </thead>
        <tbody>
        <th:block th:each="post: ${posts}" th:height="auto" >
            <tr class="posts" th:data-id="${post.id}">
                <td>
                    <a th:data-recipient-id="${post.user.id}" th:data-recipient-name="${post.user.username}" class="btn btn-secondary" data-toggle="modal" data-target="#exampleModal">   <img th:if="${post.user.profile.uploadPath}"  th:src="@{/uploads/} + ${post.user.profile.uploadPath}"  class="message-md-avatar" /></a>

                </td>
                <td>
                    <span th:text="${post.user.profile.firstName}" ></span>

                    <a th:data-recipient-id="${post.user.id}" th:data-recipient-name="${post.user.username}" class="btn btn-secondary" data-toggle="modal" data-target="#exampleModal"><i class="far fa-envelope"></i></a>
                    <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                        <div class="modal-dialog" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="exampleModalLabel">New message</h5>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                <form th:action="@{/messages/create}" method="post" th:object="${post}">
                                    <div class="modal-body">

                                        <div class="form-group">
                                            <label for="recipient-id" class="col-form-label">Recipient:</label>

                                        </div>
                                        <div class="form-group">
                                            <label for="message" class="col-form-label">Message:</label>
                                            <textarea class="form-control" id="message" name="message"></textarea>

                                        </div>

                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                        <button type="submit" class="btn btn-primary">Send message</button>

                                    </div>

                                    <input type="hidden" name="recipient-id" id="recipient-id" th:value="${post.user.id}"/>
                                </form>
                            </div>
                        </div>
                    </div>
                </td>
                <td>
                    <span th:text="${post.user.profile.userState}" ></span>
                </td>
                <td>
                    <span th:text="${post.message}" ></span>
                </td>

                <td>
                    <div class="card-body outer">
                        <form class="card" th:action="@{/topic/state/}+${id}" method="post" th:object="${post}">
                            <input type="text" id="message" name="message" />

                            <button class="btn btn-primary">New Post</button>
                        </form>
                    </div>
                    <!--td<button type="button" th:data-id="${postTopic.id}"  class="btn btn-secondary" data-toggle="modal" data-target="#exampleModal">New Post</button>-->

                    <!--<div class="modal fade" id="exampleModal2" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel2" aria-hidden="true">-->
                        <!--<div class="modal-dialog" role="document">-->
                            <!--<div class="modal-content">-->
                                <!--<div class="modal-header">-->
                                    <!--<h5 class="modal-title" id="exampleModalLabel2">New message</h5>-->
                                    <!--<button type="button" class="close" data-dismiss="modal" aria-label="Close">-->
                                        <!--<span aria-hidden="true">&times;</span>-->
                                    <!--</button>-->
                                <!--</div>-->
                                <!--<form class="card" th:action="@{/topic/state/}+${id}" method="post" th:object="${post}">-->
                                    <!--<input type="text" id="message" name="message" />-->
                                    <!--<div class="modal-body">-->

                                    <!--<button class="btn btn-primary">New Post</button>-->
                                        <!--<div class="form-group">-->
                                            <!--<label for="message" class="col-form-label">Message:</label>-->
                                            <!--<textarea class="form-control" id="message" name="message"></textarea>-->
                                        <!--</div>-->
                                    <!--</div>-->
                                    <!--<div class="modal-footer">-->
                                        <!--<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>-->
                                        <!--<button type="submit" class="btn btn-primary">Post</button>-->
                                        <!--<input type="hidden" name="postTopic" id="postTopic" th:value="${postTopic.id}"/>-->

                                    <!--</div>-->

                                <!--</form>-->
                            <!--</div>-->
                        <!--</div>-->
                    <!--</div>-->

                </td>
            </tr>

            </th:block>
        </tbody>
    </table>
    <div class="card-body outer">
        <form class="card" th:action="@{/topic/state/}+${id}" method="post" th:object="${post}">
            <input type="text" id="message" name="message" />

            <button class="btn btn-primary">New Post</button>
        </form>
    </div>


</div>
<div th:replace="partials/layout :: footer" />
<script type="text/javascript">

    $('#exampleModal').on('show.bs.modal', function (event) {
        var button = $(event.relatedTarget) // Button that triggered the modal

        var modal = $(this);

        console.log("yo");
        console.log(button.attr("data-recipient-id"));

        $('#recipient-name').text(button.attr("data-recipient-name"));
        $('#recipient-id').val(button.attr("data-recipient-id"));
    })

</script>

</body>
</html>